### Example of **Cilium Data Flow**:

```
  flowchart TB
  subgraph Linux_Kernel["Linux Kernel"]
          TC["TC - Ingress/Egress"]
          XDP["XDP - Ingress"]
          SO["Socket Ops"]
          CG["cgroups - Pod"]
    end
      XDP --> TC
      TC --> SO
      SO --> CG
      BPF(("eBPF Programs")) -.-> XDP & TC & SO & CG

      style BPF fill:#f96,stroke:#333,stroke-width:2px
      style Linux_Kernel fill:#f5f5f5,stroke:#666
```

### iptables Limitations:

```
graph LR
    P([Packet]) --> R1[Rule 1: Match?]
    R1 -- No --> R2[Rule 2: Match?]
    R2 -- No --> R3[Rule 3: Match?]
    R3 -- No --> RN[Rule N: Match?]
    RN -- Yes --> Action[Allow/Drop]
```

### eBPF Advantages: 
```
graph LR
    P([Packet]) --> Prog[eBPF Program]
    Prog --> Dec["Decision (O(1) hash lookup)"]
    Prog --> Map[(eBPF Maps
                  Hash Tables)]
                  
    style Map fill:#fff9c4,stroke:#fbc02d
```

### Architecture Overview

```
graph TB
    subgraph Cluster["Kubernetes Cluster"]
        direction TB
        
        subgraph CP["Control Plane"]
            direction LR
            Operator["<b>Cilium Operator</b><br/><i>(Deployment)</i><br/>• CRD Management<br/>• IPAM<br/>• Cluster Mesh"]
            Relay["<b>Hubble Relay</b><br/><i>(Deployment)</i><br/>• Aggregates flows<br/>• Serves Hubble UI/CLI"]
        end

        subgraph Node1["Worker Node (DaemonSet)"]
            direction TB
            subgraph Agent["Cilium Agent"]
                direction LR
                BPF["eBPF Datapath"]
                Observer["Hubble Observer"]
                Envoy["Envoy (L7)"]
            end

            subgraph Workloads["Workloads"]
                direction LR
                PodA["Pod A"]
                PodB["Pod B"]
                PodC["Pod C"]
            end
        end
    end

    %% Connectivity
    Operator -.->|Manages| Agent
    Relay ---|Queries| Observer
    Agent ---|Secures| Workloads

    %% Styling
    style Cluster fill:#f9f9f9,stroke:#333,stroke-width:2px
    style CP fill:#fff,stroke:#757575,stroke-dasharray: 5 5
    style Node1 fill:#fff,stroke:#333
    style Agent fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    style Workloads fill:#e1f5fe,stroke:#0288d1
    style Operator fill:#f5f5f5,stroke:#333
    style Relay fill:#f5f5f5,stroke:#333
```

### Encapsulation Mode (VXLAN/Geneve)
```
graph LR
    %% Flow
    PodA([Pod A: 10.0.1.10]) --> Agent1[Cilium Agent: Node 1]
    Agent1 ==> Tunnel{{"VXLAN / Geneve Tunnel"}}
    Tunnel ==> Agent2[Cilium Agent: Node 2]
    Agent2 --> PodB([Pod B: 10.0.2.20])



    style Tunnel fill:#fff9c4,stroke:#fbc02d
    style Agent1 fill:#fff3e0,stroke:#ef6c00
    style Agent2 fill:#fff3e0,stroke:#ef6c00
```

### Native Routing (Direct Routing)
```
graph LR
    %% Flow
    PodA([Pod A: 10.0.1.10]) --> Agent1[Cilium Agent: Node 1]
    Agent1 <== "Native IP Routing (BGP / VPC Routes)" ==> Agent2[Cilium Agent: Node 2]
    Agent2 --> PodB([Pod B: 10.0.2.20])



    style Agent1 fill:#fff3e0,stroke:#ef6c00
    style Agent2 fill:#fff3e0,stroke:#ef6c00
```

### Traditional IP-based Security
```
graph LR
    %% Components
    PodA([Pod A: 10.0.1.5])
    FW{Firewall}
    PodB([Pod B])

    %% Flow
    PodA -->|"Traffic (Src IP: 10.0.1.5)"| FW
    FW -->|"Allow 10.0.1.5"| PodB

    style FW fill:#ffebee,stroke:#c62828
```

### Cilium Identity-based Security
```
graph LR
    %% Components
    subgraph Pod_A["Pod A"]
        direction TB
        L1["Labels: app=frontend"]
        ID1["Identity: 12345"]
    end

    Cilium{Cilium Enforcement}

    subgraph Pod_B["Pod B"]
        direction TB
        L2["Labels: app=backend"]
        ID2["Identity: 67890"]
    end

    %% Flow
    Pod_A -->|"Traffic (Identity: 12345)"| Cilium
    Cilium -->|"Rule: Allow app=frontend"| Pod_B

    %% Styling
    style Cilium fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    style Pod_A fill:#e1f5fe,stroke:#01579b
    style Pod_B fill:#e1f5fe,stroke:#01579b
```

### Sidecar vs Sidecarless Architecture


- Traditional Sidecar Service Mesh
```
graph LR
    subgraph Pod1 ["Pod 1"]
        direction LR
        App1["App"]
        Proxy1["Sidecar Proxy"]
    end

    subgraph Pod2 ["Pod 2"]
        direction LR
        Proxy2["Sidecar Proxy"]
        App2["App"]
    end

    %% Communication Flow
    App1 <--> Proxy1
    Proxy1 <-->|"Network Traffic"| Proxy2
    Proxy2 <--> App2

    %% Styling
    style Proxy1 fill:#ffebee,stroke:#c62828
    style Proxy2 fill:#ffebee,stroke:#c62828
    style App1 fill:#e1f5fe,stroke:#01579b
    style App2 fill:#e1f5fe,stroke:#01579b
```

- Cilium Sidecarless Service Mesh
```
graph TD
    %% App Pods
    App1(["App Pod 1"])
    App2(["App Pod 2"])

    %% Kernel Layer
    subgraph Kernel["Linux Kernel (eBPF Datapath)"]
        direction TB
        EBPF["<b>Cilium eBPF Programs</b><br/>• L4 Load Balancing<br/>• Transparent mTLS<br/>• Network Policy Enforcement"]
    end

    %% Node Layer
    subgraph Shared["Per-Node Shared Proxy"]
        direction TB
        Envoy["<b>Cilium Envoy</b><br/>• L7 Policies: HTTP, gRPC, Kafka<br/>• Path-based routing"]
    end

    %% Traffic Flow
    App1 --> EBPF
    App2 --> EBPF
    EBPF <-->|L7 Inspection| Envoy

    %% Styling
    style EBPF fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    style Envoy fill:#e1f5fe,stroke:#0288d1
    style App1 fill:#ffffff,stroke:#333
    style App2 fill:#ffffff,stroke:#333
    style Kernel fill:#f5f5f5,stroke:#757575,stroke-dasharray: 5 5
```

### Hubble Architecture
```
graph TD
    %% User Interfaces
    subgraph UI_Layer["Access Layer"]
        direction LR
        UI["Hubble UI (Web)"]
        CLI["Hubble CLI (hubble observe)"]
    end

    %% Aggregation Layer
    Relay["<b>Hubble Relay</b><br/>(Aggregator Deployment)<br/>• Collects data from all nodes<br/>• Provides API for UI/CLI"]

    %% Node Layer
    subgraph Nodes["Cluster Nodes"]
        direction LR
        subgraph Node1["Node 1"]
            A1["Cilium Agent<br/>(Hubble Server)"]
        end
        subgraph Node2["Node 2"]
            A2["Cilium Agent<br/>(Hubble Server)"]
        end
        subgraph Node3["Node 3"]
            A3["Cilium Agent<br/>(Hubble Server)"]
        end
    end

    %% Communication Flow
    UI & CLI --- Relay
    Relay --- A1
    Relay --- A2
    Relay --- A3

    %% Styling
    style Relay fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    style Node1 fill:#f5f5f5,stroke:#757575
    style Node2 fill:#f5f5f5,stroke:#757575
    style Node3 fill:#f5f5f5,stroke:#757575
    style UI fill:#e1f5fe,stroke:#0288d1
    style CLI fill:#e1f5fe,stroke:#0288d1
```

### Cluster Mesh Architecture
```
graph LR
    %% Cluster A
    subgraph Cluster_A ["Cluster A (ID: 1)"]
        direction TB
        A_Pods(["Pods (10.1.0.0/16)"])
        A_APIServer["clustermesh-apiserver"]
    end

    %% Cluster B
    subgraph Cluster_B ["Cluster B (ID: 2)"]
        direction TB
        B_Pods(["Pods (10.2.0.0/16)"])
        B_APIServer["clustermesh-apiserver"]
    end

    %% Cross-Cluster Connectivity
    A_APIServer <== "mTLS Tunnel (Control Plane Sync)" ==> B_APIServer
    A_Pods <== "Direct Pod-to-Pod Routing" ==> B_Pods



    %% Styling
    style Cluster_A fill:#f5f5f5,stroke:#333
    style Cluster_B fill:#f5f5f5,stroke:#333
    style A_APIServer fill:#fff3e0,stroke:#ef6c00
    style B_APIServer fill:#fff3e0,stroke:#ef6c00

```